<?phpuse Illuminate\Database\Capsule\Manager as DB;class GoodscatController extends CommonController{    public function init() {        $this->table = 'goods_cat';        $this->primaryKey = 'id';        parent::init();    }    #目录添加form    public function addAction(){        $upRow = DB::table($this->table)->where('up','=',0)->get();        foreach ($upRow as $k=>&$v){            $v['text']      =  $v['title'];            $v['children']  =  DB::table($this->table)->where('up','=',$v['id'])->get();        }        $this->_view->assign('upRow',	 $upRow);        $this->_view->assign('attribute',DB::table('attribute')->get());        parent::addAction();    }	#目录添加action	public function increaseAction() {		$title	=	$this->get('title','');		$up		=	$this->get('up', 0);		$inputs		= array(				['name'=>'title','value'=>$title,'role'=>'required|unique:goods_cat.title','msg'=>'产品目录标题'],				['name'=>'up','value'=>$up,	'fun'=>'isInt', 'msg'=>'上级目录'],		);		$result		= Validate::check($inputs);		if(	!empty($result) ){ret(1, $result);}        $attributes =   $this->get('attributes', []);        if(!empty($attributes)){            $attributes = array_unique($attributes);        }        $this->formData['attributes'] = implode(',', $attributes);        parent::increaseAction();    }    #目录添加form    public function editAction(){        $dataset = parent::editAction(TRUE);        $upRow = DB::table($this->table)->where('up','=',0)->get();        foreach ($upRow as $k=>&$v){            $v['text']      =  $v['title'];            $v['children']  =  DB::table($this->table)->where('up','=',$v['id'])->get();        }        $this->_view->assign('upRow',	 $upRow);        $attrList     =DB::table('attribute')->get();        $selectedAttr =empty($dataset['attributes'])?[]:explode(',', $dataset['attributes']);        foreach($attrList as $k=>&$v){            $v['flag'] = in_array($v['id'], $selectedAttr);        }        $this->_view->assign('attribute', $attrList);    }	#目录修改	public function updateAction() {        $id		=	$this->get('id',    0);		$title	=	$this->get('title','');		$up		=	$this->get('up', 0);		$inputs	= array(				['name'=>'title','value'=>$title,'role'=>'required','msg'=>'产品目录标题'],				['name'=>'up','value'=>$up,'role'=>'neq:'.$id,'fun'=>'isInt','msg'=>'上级目录'],		);		$result	= Validate::check($inputs);		if(	!empty($result) ){ret(1, $result);}        $attributes =   $this->get('attributes', []);        if(!empty($attributes)){            $attributes = array_unique($attributes);        }        $this->formData['attributes'] = implode(',', $attributes);		parent::updateAction();    }}